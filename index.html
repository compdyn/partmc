<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PartMC: &lt;img src=&quot;https://raw.githubusercontent.com/wiki/compdyn/partmc/logo.svg&quot; alt=&quot;PartMC&quot;/&gt;</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PartMC
   &#160;<span id="projectnumber">2.8.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title"><img src="https://raw.githubusercontent.com/wiki/compdyn/partmc/logo.svg" alt="PartMC" style="pointer-events: none;" class="inline"/> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__partmc_README"></a></p>
<p>PartMC: Particle-resolved Monte Carlo code for atmospheric aerosol simulation</p>
<p><a href="https://github.com/compdyn/partmc/blob/master/ChangeLog.md"><img src="https://img.shields.io/github/tag/compdyn/partmc.svg?label=version" alt="Latest version" style="pointer-events: none;" class="inline"/></a> <a href="https://compdyn.github.io/partmc/"><img src="https://img.shields.io/badge/docs-GitHub%20Pages-blue" alt="Documentation" class="inline"/></a> <a href="https://hub.docker.com/r/compdyn/partmc/builds/"><img src="https://img.shields.io/docker/automated/compdyn/partmc.svg" alt="Docker build status" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/compdyn/partmc/actions/workflows/main.yml"><img src="https://github.com/compdyn/partmc/workflows/CI/badge.svg?branch=master" alt="Github Actions Status" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/compdyn/partmc/blob/master/COPYING"><img src="https://img.shields.io/github/license/compdyn/partmc.svg" alt="License" style="pointer-events: none;" class="inline"/></a> <a href="https://zenodo.org/badge/latestdoi/24058992"><img src="https://zenodo.org/badge/24058992.svg" alt="DOI" style="pointer-events: none;" class="inline"/></a></p>
<p>Version 2.8.0 <br  />
 Released 2024-02-23</p>
<p><b>Repository:</b> <a href="https://github.com/compdyn/partmc">https://github.com/compdyn/partmc</a></p>
<p><b>Documentation:</b> <a href="https://compdyn.github.io/partmc/">https://compdyn.github.io/partmc/</a></p>
<p><b>Cite as:</b> M. West, N. Riemer, J. Curtis, M. Michelotti, and J. Tian (2024) PartMC, <a href="https://github.com/compdyn/partmc"><img src="https://img.shields.io/github/release/compdyn/partmc.svg?label=version" alt="version" style="pointer-events: none;" class="inline"/></a>, <a href="https://zenodo.org/badge/latestdoi/24058992"><img src="https://zenodo.org/badge/24058992.svg" alt="DOI" style="pointer-events: none;" class="inline"/></a></p>
<p>Copyright (C) 2005-2024 Nicole Riemer and Matthew West <br  />
 Portions copyright (C) Andreas Bott, Richard Easter, Jeffrey Curtis, Matthew Michelotti, and Jian Tian <br  />
 Licensed under the GNU General Public License version 2 or (at your option) any later version. <br  />
 For details see the file COPYING or <a href="http://www.gnu.org/licenses/old-licenses/gpl-2.0.html">http://www.gnu.org/licenses/old-licenses/gpl-2.0.html</a>.</p>
<p><b>References:</b></p>
<ul>
<li>N. Riemer, M. West, R. A. Zaveri, and R. C. Easter (2009) Simulating the evolution of soot mixing state with a particle-resolved aerosol model, <em>J. Geophys. Res.</em> 114(D09202), <a href="http://dx.doi.org/10.1029/2008JD011073">http://dx.doi.org/10.1029/2008JD011073</a>.</li>
<li>N. Riemer, M. West, R. A. Zaveri, and R. C. Easter (2010) Estimating black carbon aging time-scales with a particle-resolved aerosol model, <em>J. Aerosol Sci.</em> 41(1), 143-158, <a href="http://dx.doi.org/10.1016/j.jaerosci.2009.08.009">http://dx.doi.org/10.1016/j.jaerosci.2009.08.009</a>.</li>
<li>R. A. Zaveri, J. C. Barnard, R. C. Easter, N. Riemer, and M. West (2010) Particle-resolved simulation of aerosol size, composition, mixing state, and the associated optical and cloud condensation nuclei activation properties in an evolving urban plume, <em>J. Geophys. Res.</em> 115(D17210), <a href="http://dx.doi.org/10.1029/2009JD013616">http://dx.doi.org/10.1029/2009JD013616</a>.</li>
<li>R. E. L. DeVille, N. Riemer, and M. West (2011) Weighted Flow Algorithms (WFA) for stochastic particle coagulation, <em>J. Comp. Phys.</em> 230(23), 8427-8451, <a href="http://dx.doi.org/10.1016/j.jcp.2011.07.027">http://dx.doi.org/10.1016/j.jcp.2011.07.027</a></li>
<li>J. Ching, N. Riemer, and M. West (2012) Impacts of black carbon mixing state on black carbon nucleation scavenging: Insights from a particle-resolved model, <em>J. Geophys. Res.</em> 117(D23209), <a href="http://dx.doi.org/10.1029/2012JD018269">http://dx.doi.org/10.1029/2012JD018269</a></li>
<li>M. D. Michelotti, M. T. Heath, and M. West (2013) Binning for efficient stochastic multiscale particle simulations, <em>Multiscale Model. Simul.</em> 11(4), 1071-1096, <a href="http://dx.doi.org/10.1137/130908038">http://dx.doi.org/10.1137/130908038</a></li>
<li>N. Riemer and M. West (2013) Quantifying aerosol mixing state with entropy and diversity measures, <em>Atmos. Chem. Phys.</em> 13, 11423-11439, <a href="http://dx.doi.org/10.5194/acp-13-11423-2013">http://dx.doi.org/10.5194/acp-13-11423-2013</a></li>
<li>J. Tian, N. Riemer, M. West, L. Pfaffenberger, H. Schlager, and A. Petzold (2014) Modeling the evolution of aerosol particles in a ship plume using PartMC-MOSAIC, <em>Atmos. Chem. Phys.</em> 14, 5327-5347, <a href="http://dx.doi.org/10.5194/acp-14-5327-2014">http://dx.doi.org/10.5194/acp-14-5327-2014</a></li>
<li>R. M. Healy, N. Riemer, J. C. Wenger, M. Murphy, M. West, L. Poulain, A. Wiedensohler, I. P. O'Connor, E. McGillicuddy, J. R. Sodeau, and G. J. Evans (2014) Single particle diversity and mixing state measurements, <em>Atmos. Chem. and Phys.</em> 14, 6289-6299, <a href="http://dx.doi.org/10.5194/acp-14-6289-2014">http://dx.doi.org/10.5194/acp-14-6289-2014</a></li>
<li>J. H. Curtis, M. D. Michelotti, N. Riemer, M. Heath, and M. West (2016) Accelerated simulation of stochastic particle removal processes in particle-resolved aerosol models, <em>J. Comp. Phys.</em> 322, 21-32, <a href="http://dx.doi.org/10.1016/j.jcp.2016.06.029">http://dx.doi.org/10.1016/j.jcp.2016.06.029</a></li>
<li>J. Ching, N. Riemer, and M. West (2016) Black carbon mixing state impacts on cloud microphysical properties: Effects of aerosol plume and environmental conditions, <em>J. Geophys. Res.</em> 121(10), 5990-6013, <a href="http://dx.doi.org/10.1002/2016JD024851">http://dx.doi.org/10.1002/2016JD024851</a></li>
<li>J. Ching, J. Fast, M. West, and N. Riemer (2017) Metrics to quantify the importance of mixing state for CCN activity, <em>Atmos. Chem. and Phys.</em> 17, 7445-7458, <a href="http://dx.doi.org/10.5194/acp-17-7445-2017">http://dx.doi.org/10.5194/acp-17-7445-2017</a></li>
<li>J. Tian, B. T. Brem, M. West, T. C. Bond, M. J. Rood, and N. Riemer (2017) Simulating aerosol chamber experiments with the particle-resolved aerosol model PartMC, <em>Aerosol Sci. Technol.</em> 51(7), 856-867, <a href="http://dx.doi.org/10.1080/02786826.2017.1311988">http://dx.doi.org/10.1080/02786826.2017.1311988</a></li>
<li>J. H. Curtis, N. Riemer, and M. West (2017) A single-column particle-resolved model for simulating the vertical distribution of aerosol mixing state: WRF-PartMC-MOSAIC-SCM v1.0, <em>Geosci. Model Dev.</em> 10, 4057-4079, <a href="http://dx.doi.org/10.5194/gmd-10-4057-2017">http://dx.doi.org/10.5194/gmd-10-4057-2017</a></li>
<li>J. Ching, M. West, and N. Riemer (2018) Quantifying impacts of aerosol mixing state on nucleation-scavenging of black carbon aerosol particles, <em>Atmosphere</em> 9(1), 17, <a href="http://dx.doi.org/10.3390/atmos9010017">http://dx.doi.org/10.3390/atmos9010017</a></li>
<li>M. Hughes, J. K. Kodros, J. R. Pierce, M. West, and N. Riemer (2018) Machine learning to predict the global distribution of aerosol mixing state metrics, <em>Atmosphere</em> 9(1), 15, <a href="http://dx.doi.org/10.3390/atmos9010015">http://dx.doi.org/10.3390/atmos9010015</a></li>
<li>R. E. L. DeVille, N. Riemer, and M. West (2019) Convergence of a generalized Weighted Flow Algorithm for stochastic particle coagulation, <em>Journal of Computational Dynamics</em> 6(1), 69-94, <a href="http://dx.doi.org/10.3934/jcd.2019003">http://dx.doi.org/10.3934/jcd.2019003</a></li>
<li>N. Riemer, A. P. Ault, M. West, R. L. Craig, and J. H. Curtis (2019) Aerosol mixing state: Measurements, modeling, and impacts, <em>Reviews of Geophysics</em> 57(2), 187-249, <a href="http://dx.doi.org/10.1029/2018RG000615">http://dx.doi.org/10.1029/2018RG000615</a></li>
<li>C. Shou, N. Riemer, T. B. Onasch, A. J. Sedlacek, A. T. Lambe, E. R. Lewis, P. Davidovits, and M. West (2019) Mixing state evolution of agglomerating particles in an aerosol chamber: Comparison of measurements and particle-resolved simulations, <em>Aerosol Science and Technology</em> 53(11), 1229-1243, <a href="http://dx.doi.org/10.1080/02786826.2019.1661959">http://dx.doi.org/10.1080/02786826.2019.1661959</a></li>
<li>J. T. Gasparik, Q. Ye, J. H. Curtis, A. A. Presto, N. M. Donahue, R. C. Sullivan, M. West, and N. Riemer (2020) Quantifying errors in the aerosol mixing-state index based on limited particle sample size, <em>Aerosol Science and Technology</em> 54(12), 1527-1541, <a href="http://dx.doi.org/10.1080/02786826.2020.1804523">http://dx.doi.org/10.1080/02786826.2020.1804523</a></li>
<li>Z. Zheng, J. H. Curtis, Y. Yao, J. T. Gasparik, V. G. Anantharaj, L. Zhao, M. West, and N. Riemer (2021) Estimating submicron aerosol mixing state at the global scale with machine learning and earth system modeling, <em>Earth and Space Science</em> 8(2), e2020EA001500, <a href="http://dx.doi.org/10.1029/2020EA001500">http://dx.doi.org/10.1029/2020EA001500</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md0"></a>
Running PartMC with Docker</h1>
<p>This is the fastest way to get running.</p>
<ul>
<li>**_Step 1:_** Install <a href="https://www.docker.com/community-edition">Docker Community Edition</a>.<ul>
<li>On Linux and MacOS this is straightforward. <a href="https://store.docker.com/search?type=edition&amp;offering=community">Download from here</a>.</li>
<li>On Windows the best version is <a href="https://store.docker.com/editions/community/docker-ce-desktop-windows">Docker Community Edition for Windows</a>, which requires Windows 10 Pro/Edu.</li>
</ul>
</li>
<li>**_Step 2:_** (Optional) Run the PartMC test suite with: <pre class="fragment">  docker run -it --rm compdyn/partmc bash -c 'cd /build; make test'
</pre></li>
<li>**_Step 3:_** Run a scenario like the following. This example uses <code>partmc/scenarios/4_chamber</code>. This mounts the current directory (<code>$PWD</code>, replace with <code>cd%</code> on Windows) into <code>/run</code> inside the container, changes into that directory, and then runs PartMC. <pre class="fragment">  cd partmc/scenarios/4_chamber
  docker run -it --rm -v $PWD:/run compdyn/partmc bash -c 'cd /run; /build/partmc chamber.spec'
</pre></li>
</ul>
<p>In the above <code>docker run</code> command the arguments are:</p>
<ul>
<li><code>-it</code>: activates "interactive" mode so Ctrl-C works to kill the command</li>
<li><code>--rm</code>: remove temporary docker container files after running</li>
<li><code>-v LOCAL:REMOTE</code>: mount the <code>LOCAL</code> directory to the <code>REMOTE</code> directory inside the container</li>
<li><code>compdyn/partmc</code>: the docker image to run</li>
<li>&lsquo;bash -c 'COMMAND&rsquo;<code>: run</code>COMMAND` inside the docker container</li>
</ul>
<p>The directory structure inside the docker container is: </p><pre class="fragment">/partmc           # a copy of the partmc git source code repository
/build            # the diretory in which partmc was compiled
/build/partmc     # the compiled partmc executable
/run              # the default diretory to run in
</pre><h1><a class="anchor" id="autotoc_md1"></a>
Dependencies</h1>
<p>Required dependencies:</p>
<ul>
<li>Fortran 2003 compiler - <a href="https://gcc.gnu.org/fortran/">https://gcc.gnu.org/fortran/</a> or similar</li>
<li>CMake version 2.6.4 or higher - <a href="http://www.cmake.org/">http://www.cmake.org/</a></li>
<li>NetCDF version 4.2 or higher - <a href="http://www.unidata.ucar.edu/software/netcdf/">http://www.unidata.ucar.edu/software/netcdf/</a></li>
</ul>
<p>Optional dependencies:</p>
<ul>
<li>CAMP chemistry code - <a href="https://github.com/open-atmos/camp">https://github.com/open-atmos/camp</a></li>
<li>MOSAIC chemistry code version 2012-01-25 - Available from Rahul Zaveri - <a href="#" onclick="location.href='mai'+'lto:'+'Rah'+'ul'+'.Za'+'ve'+'ri@'+'pn'+'l.g'+'ov'; return false;">Rahul<span style="display: none;">.nosp@m.</span>.Zav<span style="display: none;">.nosp@m.</span>eri@p<span style="display: none;">.nosp@m.</span>nl.g<span style="display: none;">.nosp@m.</span>ov</a></li>
<li>MPI parallel support - <a href="http://www.open-mpi.org/">http://www.open-mpi.org/</a></li>
<li>GSL for random number generators - <a href="http://www.gnu.org/software/gsl/">http://www.gnu.org/software/gsl/</a></li>
<li>SUNDIALS ODE solver for condensation support - <a href="http://www.llnl.gov/casc/sundials/">http://www.llnl.gov/casc/sundials/</a></li>
<li>gnuplot for testcase plotting - <a href="http://www.gnuplot.info/">http://www.gnuplot.info/</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
Installation</h1>
<ol type="1">
<li>Install cmake and NetCDF (see above). The NetCDF libraries are required to compile PartMC. The <code>netcdf.mod</code> Fortran 90 module file is required, and it must be produced by the same compiler being used to compile PartMC.</li>
<li>Unpack PartMC: <pre class="fragment"> tar xzvf partmc-2.8.0.tar.gz
</pre></li>
<li>Change into the main PartMC directory (where this README file is located): <pre class="fragment"> cd partmc-2.8.0
</pre></li>
<li>Make a directory called <code>build</code> and change into it: <pre class="fragment"> mkdir build
 cd build
</pre></li>
<li><p class="startli">If desired, set environment variables to indicate the install locations of supporting libraries. If running <code>echo $SHELL</code> indicates that you are running <code>bash</code>, then you can do something like: </p><pre class="fragment"> export NETCDF_HOME=/
 export MOSAIC_HOME=${HOME}/mosaic-2012-01-25
 export SUNDIALS_HOME=${HOME}/opt
 export GSL_HOME=${HOME}/opt
</pre><p class="startli">Of course the exact directories will depend on where the libraries are installed. You only need to set variables for libraries installed in non-default locations, and only for those libraries you want to use. Everything except NetCDF is optional.</p>
<p class="startli">If <code>echo $SHELL</code> instead is <code>tcsh</code> or similar, then the environment variables can be set like <code>setenv NETCDF_HOME /</code> and similarly.</p>
</li>
<li>Run cmake with the main PartMC directory as an argument (note the double-c): <pre class="fragment"> ccmake ..
</pre></li>
<li>Inside ccmake press <code>c</code> to configure, edit the values as needed, press <code>c</code> again, then <code>g</code> to generate. Optional libraries can be activated by setting the <code>ENABLE</code> variable to <code>ON</code>. For a parallel build, toggle advanced mode with <code>t</code> and set the <code>CMAKE_Fortran_COMPILER</code> to <code>mpif90</code>, then reconfigure.</li>
<li>Optionally, enable compiler warnings by pressing <code>t</code> inside ccmake to enable advanced options and then setting <code>CMAKE_Fortran_FLAGS</code> to: <pre class="fragment"> -O2 -g -fimplicit-none -W -Wall -Wconversion -Wunderflow -Wimplicit-interface -Wno-compare-reals -Wno-unused -Wno-unused-parameter -Wno-unused-dummy-argument -fbounds-check
</pre></li>
</ol>
<ol type="1">
<li>Compile PartMC and test it as follows. <pre class="fragment"> make
 make test
</pre></li>
<li>To run just a single test do something like: <pre class="fragment"> ctest -R bidisperse   # argument is a regexp for test names
</pre></li>
<li>To see what make is doing run it like: <pre class="fragment">VERBOSE=1 make
</pre></li>
<li>To run tests with visible output or to make some plots from the tests run them as follows. Note that tests often rely on earlier tests in the same directory, so always run <code>test_1</code>, then <code>test_2</code>, etc. Tests occasionally fail due to random sampling, so re-run the entire sequence after failures. For example: <pre class="fragment">cd test_run/emission
./test_emission_1.sh
./test_emission_2.sh
./test_emission_3.sh            # similarly for other tests
gnuplot -persist plot_species.gnuplot # etc...
</pre></li>
<li>To run full scenarios, do, for example: <pre class="fragment">cd ../scenarios/1_urban_plume
./1_run.sh
</pre></li>
</ol>
<h1><a class="anchor" id="autotoc_md3"></a>
Usage</h1>
<p>The main <code>partmc</code> command reads <code>.spec</code> files and does the run specified therein. Either particle-resolved runs, sectional-code runs, or exact solutions can be generated. A run produces one NetCDF file per output timestep, containing per-particle data (from particle-resolved runs) or binned data (from sectional or exact runs). The <code>extract_*</code> programs can read these per-timestep NetCDF files and output ASCII data (the <code>extract_sectional_*</code> programs are used for sectional and exact model output).</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Python bindings</h1>
<p>The <a href="https://github.com/open-atmos/PyPartMC">PyPartMC</a> project offers pip-installable Python bindings to PartMC. Both source and binary packages are available and ship with all PartMC dependencies included. PyPartMC exposes internal components of PartMC (utility routines and derived types) which then can serve as building blocks to develop PartMC simulations in Python. Time stepping can be performed either using the internal PartMC time-stepper or externally within a Python loop. The latter allows to couple the simulation with external Python components in each timestep. PyPartMC features examples developed as Jupyter notebooks. Snippets of code provided in the README file depict how to use PyPartMC from Julia (using PyCall.jl) and Matlab (using Matlab's built-in Python bridge). </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<hr class="footer"/><address class="footer"><small>
PartMC 2.8.0 documentation generated by <a href="http://www.doxygen.org/index.html">doxygen</a> 1.8.20</small></address>
</body>
</html>
